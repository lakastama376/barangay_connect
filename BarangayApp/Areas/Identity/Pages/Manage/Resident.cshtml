@page
@model BarangayApp.Areas.Identity.Pages.Manage.ResidentModel
@{
    ViewData["Title"] = "Residents Information";
}

<div class="row justify-content-center">
    <div class="col-md-8 text-center">
        <h1 class="mb-3" style="color:white;">Residents Information</h1>
        <hr style="border-color:white;" />
    </div>
</div>
<!-- Search Form -->
<div class="row justify-content-center mb-3">
    <div class="col-md-4">
        <form method="get">
            <div class="input-group">
                <input type="text" name="Search" value="@Model.Search" class="form-control" placeholder="Search by Name or Email..." />
                <button type="submit" style="background-color:#004d00; border:1px solid white;" class="btn btn-primary">Search</button>
                <a asp-page="./Resident" class="btn btn-secondary">Clear</a>
            </div>
        </form>
    </div>
</div>
<!-- Table of Residents Info -->
<div class="row justify-content-center">
    <div class="col-md-9">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                @if (Model.Residents != null && Model.Residents.Count > 0)
                {
                    <table class="table table-hover align-middle text-center table-bordered"
                           style="background-color: white;">
                        <thead class="table-success">
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Address</th>
                                <th>Gender</th>
                                <th>Age</th>
                                <th>Contact Number</th>
                                <th>Created At</th>
                                <th> </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var resident in Model.Residents)
                            {
                                <tr>
                                    <td>@resident.FirstName @resident.MiddleName @resident.LastName</td>
                                    <td>@resident.Email</td>
                                    <td>@resident.Address</td>
                                    <td>@resident.Gender</td>
                                    <td>@resident.Age</td>
                                    <td>@resident.PhoneNumber</td>
                                    <td>@resident.CreatedAt.ToString("MM/dd/yyyy")</td>
                                    <td>
                                        <div class="d-flex justify-content-center gap-2">
                                            <!-- View Certificate  -->
                                            @if (!string.IsNullOrEmpty(resident.BarangayCertificatePath))
                                            {
                                                <button type="button" class="btn btn-warning btn-sm"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#certificateModal"
                                                        data-certificate="@resident.BarangayCertificatePath">
                                                    <i class="bi bi-file-earmark-text"></i> View Certificate
                                                </button>
                                            }
                                            <!-- Remove Account of Resident only for Admin -->
                                            @if (User.IsInRole("Admin"))
                                            {
                                                <form method="post" asp-page-handler="Delete" asp-route-id="@resident.Id" class="d-inline">
                                                    <button type="submit" class="btn btn-danger btn-sm"
                                                            onclick="return confirm('Are you sure you want to delete this resident?');">
                                                        <i class="bi bi-trash"></i> Delete
                                                    </button>
                                                </form>
                                            }
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-danger">No residents found.</p>
                }
            </div>
        </div>
    </div>
</div>
<!-- Certificate Modal -->
<div class="modal fade" id="certificateModal" tabindex="-1" aria-labelledby="certificateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background-color: rgba(224, 247, 255, 0.95); border: 2px solid #90ee90;">
            <div class="modal-header" style="background-color: #90ee90; color: #000;">
                <h5 class="modal-title" id="certificateModalLabel">Barangay Certificate</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex justify-content-center align-items-center" style="background-color: #f0fbff;">
                <iframe id="certificatePreview" src="" width="100%" height="600px" style="border: 1px solid #90ee90; border-radius: 6px;"></iframe>
            </div>
            <div class="modal-footer" style="background-color: #e0f7ff;">
                <a id="certificateDownloadLink" href="#" class="btn btn-primary" download>
                    <i class="bi bi-download"></i> Download
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    body, html {
        overflow-x: hidden;
    }

    body {
        background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('/Uploads/Images/background.jpg') no-repeat center center fixed;
        background-size: cover;
    }

    footer {
        display: none;
    }
</style>

@section Scripts {
    <script>
        var certificateModal = document.getElementById('certificateModal');
        certificateModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var certificate = button.getAttribute('data-certificate');

            document.getElementById('certificatePreview').src = certificate;
            document.getElementById('certificateDownloadLink').href = certificate;
        });
    </script>
}

